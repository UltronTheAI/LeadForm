# LeadForm Backend Server

This Express server serves both the API endpoints and the static frontend files from the Next.js build.

## Integrated Deployment

This project uses an integrated deployment approach where the backend server serves both:
1. API endpoints for the lead form functionality
2. Static frontend files (HTML, CSS, JS) generated by Next.js

### Available Scripts

- `npm start` - Start the server
- `npm run dev` - Start the server with nodemon for development
- `npm run update-static` - Copy the latest frontend build to the backend
- `npm run deploy` - Build the frontend, copy to backend, and start the server

## Deployment Steps

### Option 1: Automatic Deployment

The simplest way to deploy is to use the deploy script:

```bash
npm run deploy
```

This will:
1. Build the frontend application
2. Copy the static files to the backend
3. Start the backend server

### Option 2: Manual Deployment

If you prefer to do things step by step:

1. Build the frontend:
   ```bash
   cd ../lead-form
   npm run export
   ```

2. Copy the frontend build to the backend:
   ```bash
   cd ../backend
   npm run update-static
   ```

3. Start the server:
   ```bash
   npm start
   ```

## Environment Variables

Make sure your `.env` file contains:

- `PORT` - The port to run the server on (defaults to 5000)
- `MONGO_URI` - MongoDB connection string
- `TOKEN_SECRET` - Secret token for admin authentication

## Production Deployment

For production deployment to platforms like Heroku, Render, or DigitalOcean:

1. Make sure the relative API URL is set in the frontend's `.env.production` file:
   ```
   NEXT_PUBLIC_API_URL=/api
   ```

2. Deploy only the backend directory which contains both the server and the static files

3. Set up the required environment variables on your hosting platform

4. Deploy using the platform's instructions

## Troubleshooting

- If API calls are failing, check that the `NEXT_PUBLIC_API_URL` is set correctly in the frontend's `.env.production` file before building
- If the static files are not showing, make sure the `out` directory exists in the backend folder 